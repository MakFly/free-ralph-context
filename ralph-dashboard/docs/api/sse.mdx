# SSE Events Reference

Server-Sent Events for real-time updates.

## Connection

Connect to the SSE endpoint:

```typescript
const eventSource = new EventSource('http://localhost:3847/events')

eventSource.onopen = () => {
  console.log('Connected to Ralph SSE')
}

eventSource.onerror = (error) => {
  console.error('SSE error:', error)
}
```

## Event Types

### `init`

Initial data load on connection.

```typescript
eventSource.addEventListener('init', (event) => {
  const data = JSON.parse(event.data)
  // Returns: RalphStatus
})
```

**Response:**

```typescript
{
  connected: true,
  projectCount: 3,
  projects: Project[],
  sources: Source[],
  totalTokens: 145000,
  timestamp: string
}
```

### `update`

Project state change.

```typescript
eventSource.addEventListener('update', (event) => {
  const data = JSON.parse(event.data)
  // Returns: RalphStatus
})
```

### `metrics:update`

Metrics data update.

```typescript
eventSource.addEventListener('metrics:update', (event) => {
  const data = JSON.parse(event.data)
  // Returns: MetricsHistoryPoint
})
```

**Response:**

```typescript
{
  id: string,
  sessionId: string,
  timestamp: string,
  metricType: string,
  metricValue: number,
  metadata?: any
}
```

### `sync:progress`

File synchronization progress.

```typescript
eventSource.addEventListener('sync:progress', (event) => {
  const data = JSON.parse(event.data)
  // Returns: SyncProgressEvent
})
```

**Response:**

```typescript
{
  transcriptPath: string,
  status: string,
  progress: number,
  total: number,
  current: number
}
```

### `sync:error`

Synchronization error.

```typescript
eventSource.addEventListener('sync:error', (event) => {
  const data = JSON.parse(event.data)
  // Returns: SyncErrorEvent
})
```

**Response:**

```typescript
{
  transcriptPath: string,
  error: string,
  retryCount: number
}
```

## Reconnection

Auto-reconnect on connection loss:

```typescript
let retryCount = 0
const maxRetries = 5

eventSource.onerror = () => {
  if (retryCount < maxRetries) {
    setTimeout(() => {
      eventSource.close()
      connect() // Reconnect function
      retryCount++
    }, 3000)
  }
}
```

> **Info:**
> **Event Batching**: Updates are batched every 500ms to reduce network traffic.
